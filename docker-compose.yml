services:
  # PHP/Apache Web (Backend + Static Frontend)
  web:
    build:
      context: ./docker/php
      dockerfile: Dockerfile
    container_name: dnd_web
    volumes:
      - ./backend:/var/www/html/backend
      - ./frontend:/var/www/html/public
      - ./docker/apache:/etc/apache2/sites-available
    ports:
      - "8080:80"
    depends_on:
      - postgres
    environment:
      - DB_DRIVER=pgsql
      - DB_HOST=postgres
      - DB_DATABASE=dnd_charsheet
      - DB_USERNAME=dnd_user
      - DB_PASSWORD=dnd_password
      - DB_PORT=5432
    networks:
      - app_net
    restart: unless-stopped

  # PostgreSQL Datenbank
  postgres:
    image: postgres:15
    container_name: dnd_postgres
    environment:
      POSTGRES_DB: dnd_charsheet
      POSTGRES_USER: dnd_user
      POSTGRES_PASSWORD: dnd_password
    ports:
      - "5432:5432"
    volumes:
      - pg_data:/var/lib/postgresql/data
      - ./docker/postgres/init:/docker-entrypoint-initdb.d:ro
    networks:
      - app_net
    restart: unless-stopped

  # Adminer (optional)
  adminer:
    image: adminer:latest
    container_name: dnd_adminer
    environment:
      - ADMINER_DEFAULT_SERVER=postgres
    depends_on:
      - postgres
    ports:
      - "8081:8080"
    networks:
      - app_net
    restart: unless-stopped

volumes:
  pg_data:
    driver: local

networks:
  app_net:
    driver: bridge
